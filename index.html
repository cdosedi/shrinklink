<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My URL Shortener</title>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

    // ðŸ”‘ Replace with your Supabase details
    const SUPABASE_URL = "https://yktmezthrgowzjpqaosn.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrdG1lenRocmdvd3pqcHFhb3NuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNDI0MDEsImV4cCI6MjA3NDYxODQwMX0.o7KpW0oTVKlMQw56lmVE7ZGIvDByswIJ4S9HfrNkea8"
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    async function shortenUrl() {
      const longUrl = document.getElementById("longUrl").value
      if (!longUrl) {
        alert("Please enter a URL")
        return
      }

      // generate shortcode (random 5 chars)
      const shortcode = Math.random().toString(36).substring(2, 7)

      const { error } = await supabase
        .from("links")
        .insert([{ shortcode: shortcode, url: longUrl }])

      if (error) {
        alert("Error saving link")
        console.error(error)
        return
      }

      const shortUrl = `${window.location.origin}/${shortcode}`
      document.getElementById("result").innerHTML =
        `<p>âœ… Short URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a></p>`
    }

    async function redirect() {
      const path = window.location.pathname.replace("/", "")
      if (!path) return

      const { data, error } = await supabase
        .from("links")
        .select("url")
        .eq("shortcode", path)
        .single()

      if (data) {
        window.location.href = data.url
      } else {
        document.body.innerHTML = "<h1>404 - Short link not found</h1>"
      }
    }

    // Run redirect when page loads
    window.onload = redirect
    window.shortenUrl = shortenUrl
  </script>
</head>
<body>
  <h1>ðŸ”— My URL Shortener</h1>
  <input type="text" id="longUrl" placeholder="Paste your long URL here" size="50">
  <button onclick="shortenUrl()">Shorten</button>
  <div id="result"></div>
</body>
</html>
